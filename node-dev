#! /usr/bin/env node
var spawn = require('child_process').spawn;

var args = process.argv.slice(0);

if (args.length < 3) {
  console.log('Usage: node-dev [options] script.js [arguments]\n');
  process.exit(1);
}

/** Remove the node binary from the args */
var node = args.shift();

/** Replace node-dev with wrapper.js */
args[0] = __dirname + '/wrapper.js';

function start() {
  var child = spawn(node, args, {
    cwd: process.cwd(),
    env: process.env,
    customFds: [0, 1, 2]
  });
  child.on('exit', function(code) {
    if (code === 101) {
      process.nextTick(start);
    }
    else {
      process.exit(code);
    }
  });
}

start();
